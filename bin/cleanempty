#!run

export function main(...a) {
  let dir;
  if (typeof a[0]==="string"){
    dir=this.resolve(a.shift());
  } else {
    dir=this.resolve(".");
  }  
  let options=a.shift()||{};
    if (isEmpty(dir)) {
        this.echo(dir+" is removed");
        this.rm(dir,{r:1});
    } else {
        traverse.call(this,dir, options);
    }
}
function traverse(dir,options) {
    for (let s of dir.listFiles()) {
        if (isEmpty(s)) {
          if (options.f) {
            this.echo(s+" is removed");
            this.rm(s,{r:1});
          }else{
            this.echo("cleanempty "+s);
          }
        } else if(options.r && s.isDir()) {
          traverse.call(this,s,options);
        }
    }
}
function isEmpty(dir) {
    if (!dir.isDir()) return false;
    for (let f of dir.listFiles()) {
        if (!f.isDir()) return false;
        if (!isEmpty(f)) return false;
    }
    return true;
}