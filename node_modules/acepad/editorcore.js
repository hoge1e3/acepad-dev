import {isMobile} from './platform.js';
import {setEditor,getConfig,setCurrentEditor} from './states.js';
import {parseCommands,attachAcepadEditConmands} from './command.js';
import {initKeypad} from './keypad.js';
import {doClick} from './keyhandler.js';

export function edit(e){
    const ace=window.ace;
    let editor = e instanceof ace.Editor ? e 
    :ace.edit(e);
    editor.setOptions({
        enableLiveAutocompletion: true,
        scrollPastEnd:0.6,
    });
    editor.setFontSize(15);
    if(isMobile())editor.textInput.getElement().setAttribute("readonly",true);
    editor.on("focus",()=>{
        setCurrentEditor(editor);
    });
    let {commands}=getConfig();
    commands=parseCommands(commands);
    for (let k in commands) {
        editor.commands.addCommand(commands[k]);
    }
    attachAcepadEditConmands(editor);
    return editor;
}
export function initEditor(){
    const ace=window.ace;
    window.ace_language_tools=ace.require("ace/ext/language_tools");
    const editor=edit("editor");
    setEditor(editor);
    return editor;
}
export function initCore(){
    initEditor();
    initKeypad({pressHandler:doClick});
}

