// acepad-with-fs
import {open} from "acepad-browser";
import {trial,debugSession} from "acepad-debug";
import {showWidget} from "acepad-widget";
import {initVConsole,showVConsole} from "show-vconsole";
import {run} from "acepad-find";
import {add as addLog} from "./logging.js";
import unload from "@hoge1e3/unload";

export async function main(){
    const sh=this;
    await open(sh.resolve(__dirname).rel("ace.html"));
    const {setForce}=unload({
        oncancel(){
           setTimeout(()=> 
          document.documentElement.requestFullscreen().then(
              ()=>document.exitFullscreen())
        ,100);  
        }
    });
    let acepad=window.acepad=await 
    (await sh.jsm("acepad")).init();   
    sh.$acepad=window.acepad;
    let {openFile}=await sh.jsm("acepad-files");
    openFile(sh,"./");
    debugSession(sh);
    acepad.attachCommands({
        "ctrl-r":()=>location.reload(),
        showDebug:{bindKey:"ctrl-d",exec(){
            acepad.changeSession("*debug*");
        }},
        find:{
            bindKey:"ctrl-f",
            exec(){
                run(sh);
            }
        }
    });
    async function ngram(){
        for(let f of sh.resolve(".").recursive()){
            if(f.ext()!==".js")continue;
            let s=f.text();
            acepad.addToNgram(s);
            await 0;
        }
    }
    ngram();
    initVConsole();
    acepad.showMenuButtons({
        cons(){
            showVConsole();
        }
    });
    acepad.events.on("keyclick",({b})=>{
        addLog(sh,{text:b.innerText});
//        console.log("k",b.innerText);
    });
}