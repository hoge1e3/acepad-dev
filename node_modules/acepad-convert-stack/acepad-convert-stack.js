#!run
// acepad-convert-stack
import FS from "@hoge1e3/fs";
const o=("os" in FS) && FS.os;
export const convertStack=(e)=>{
    if(!o)return e;
    if(e && typeof e.stack==="string"){
        e.stack=o.convertStack(e.stack);
        return e;
    }
    return o.convertStack(e);
}    ;    
import {loadedModules} from "petit-node";
export async function main(){
    const e=`
    SyntaxError: The requested module 'blob:https://bitarrow3.eplang.jp/2fde3d1b-4211-48f0-bda7-99f47d762117' does not provide an export named 'a2'
`;
    this.echo(c.call(this,e));
    /*let r=[];
    for(let m of loadedModules()){
        console.log(m.entry.file.path(),m.url);
        //r.push(m.file.path());
    }*/
}
function c(stack){
    for(let m of loadedModules()){
        let i;
        const path=m.file.path();
        if(path.includes(m.url))continue;
        this.echo(path,m.url);
        while((i=stack.indexOf(m.url))>=0){
            stack=stack.substring(0,i)+
                path+stack.substring(i+m.url.length);
        }
        //console.log(m.entry.file.path(),m.url);
        //r.push(m.file.path());
    }
    return stack;
    
}
