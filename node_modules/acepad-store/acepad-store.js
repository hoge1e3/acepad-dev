// acepad-store
import * as $ from "acepad-ajax";
const hashurl="acepad/hash.php";
export async function put(data) { 
    let r=await $.post(hashurl,{
        data:JSON.stringify(data)
    });
    return r.id;
}
export async function get(id) {
    return await $.get(hashurl,{id});
}
export async function init(branch,data={}) {
    await $.post(hashurl,{
        key:branch,
        data:JSON.stringify(data),
    });
    return await checkout(branch);
}
export async function checkout(branch,data) {
    data=data||await $.get(hashurl,{key:branch});
    if(typeof data==="string")data={__id__:data};
    let head=data.__id__;
    return {
        data,
        async commit(data) {
            data.__prev__=head;
            let r=await $.post(hashurl,{
                key:branch,
                data:JSON.stringify(data),
            });
            data.__id__=r.id;
            return checkout(branch, data);
        }
    };
}