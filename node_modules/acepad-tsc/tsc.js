import {compileProject} from "./typescript.js";
import * as process from "process";
export function main(){
    const prj=this.resolve("./");
    process.chdir(prj.path());
    const es=compileProject(prj);
    for(let e of es){
        console.log("tscerr",e);
        const f=this.resolve(e.file.fileName);
        const {row,column}=getPosition(f.text(),e.start);
        this.echo(f.path()+":"+row+":"+column);
        this.echo(text(e));
        //this.echo(e.messageText);
        //this.echo(row,column);
    }
    return es;
}
function text(e){
    return typeof e.messageText==="string" ? 
        e.messageText :
        typeof e.messageText.messageText==="string" ? 
        e.messageText.messageText:e+"" ;
    
}
function getPosition(text, index) {
  // Handle edge cases
  if (!text || index < 0 || index > text.length) {
    throw new Error('Invalid input');
  }
  
  // Split text into lines
  const lines = text.split('\n');
  let currentIndex = 0;
  
  // Iterate through lines to find position
  for (let row = 0; row < lines.length; row++) {
    const lineLength = lines[row].length + 1; // +1 for newline character
    
    if (currentIndex + lineLength > index) {
      // Found the line containing the index
      const column = index - currentIndex;
      return { row: row + 1, column: column + 1 };
    }
    
    currentIndex += lineLength;
  }
  
  // Handle case where index is at the very end
  const lastRow = lines.length;
  const lastColumn = lines[lines.length - 1].length + 1;
  return { row: lastRow, column: lastColumn };
}