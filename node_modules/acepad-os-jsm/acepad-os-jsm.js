// acepad-os-jsm
import {sh as _sh} from "acepad-shell";
import {importModule} from "petit-node";
export let sh=_sh;

sh.addCmd("jsm",async function (path,name,args=[]){
    const sh=this;
    let f=sh.resolve(path);
    let mod;
    if(f.exists()){
        if(path.match&&!path.match(/^[\/\.]/)){
            console.warn(path,"should begin with / or ./");
        }
        mod=await importModule(f);
    }else mod=await importModule(path,sh.getcwd());
    if(name){
        const f=mod[name];
        if(!f)throw new Error(`${path} has no export ${name}`);
        return await f.apply(sh.clone(),args);
    }
    return mod;
});
sh.addCmd("testjs",function (f){
    return this.jsm(f,"test");
});
sh.addCmd("run",function (f,...args){
    return this.jsm(f,"main",args);
});
sh.addCmd("nd",function (f,...args){
    return this.jsm(f,"main",args);
});