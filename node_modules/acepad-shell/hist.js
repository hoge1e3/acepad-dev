import FS from "@hoge1e3/fs";
import {Lru} from "@hoge1e3/lru";

export function file(dir){
    return FS.get("/.meta/").rel(
        dir.relPath(FS.get("/"))
    ).rel("history.json");
}
export function read(dir){
    try{
        return file(dir).obj();
    }catch(e){
        return {};
    }
}
export function add(dir,c){
    const commandHist=read(dir);
    c=c.replace(/\s*$/," ");
    const l=new Lru(commandHist);
    l.add(c).limit(16);
    /*
    commandHist[c]=new Date().getTime();
    let s=Object.values(commandHist).sort().reverse();
    let th=s[16]||0;
    for(let k in commandHist){
        if(commandHist[k]<th)delete commandHist[k];
    }*/
    file(dir).obj(l.raw);//commandHist);
}
export function list(dir){
    const commandHist=read(dir);
    const l=new Lru(commandHist);
    return [...l].map((o)=>o.key);
    /*return Object.keys(commandHist).map((cmd)=>({
        cmd,time:commandHist[cmd]
    })).sort((a,b)=>b.time-a.time).map(({cmd})=>cmd);*/
    
}
