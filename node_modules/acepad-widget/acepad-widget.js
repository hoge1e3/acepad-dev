import {open} from "acepad-browser";
import {EventHandler} from "acepad-events";
/*global $*/
export function showIframe(url,acepad){
    acepad=acepad||window.sh.$acepad;
    let e=$("<iframe>");
    let title="w";
    if(typeof url==="string"){
        e.attr({src:url});
        title=url.substring(url.length-5);
    }
    if(typeof url.name==="function"){
        title=url.name();
    }
    
    let cont=$("<div>").append(e).attr({title});
    let r=showWidget(cont,acepad);
    if(typeof url.text==="function"){
        //alert(e[0].contentWindow.document);
        open(url,{document:e[0].contentWindow.document});
    }
    
    r.iframe=e[0];
    r.go=(url)=>{
            e.attr({src:url});
        };
    return r;
}
export function showWidget(e,acepad){
    acepad=acepad||window.sh.$acepad;
    e=$(e);
    e.addClass("widget");
    let cl=$("<button>").text("x").
    addClass("widget-close").click(close);
    let mi=$("<button>").text("_").
    addClass("widget-minify").click(minify);
    const c=$(acepad.editor.container);
    c.append(e);
    c.append(cl);
    c.append(mi);
    let b=acepad.showMenuButton(e.attr("title")||"w",()=>{
        show();
    });
    function show(){
        e.show();
        cl.show();
        mi.show();
        self.fire("show");
    }
    function close(){
        e.remove();
        cl.remove();
        mi.remove();
        b.remove();   
        self.fire("close");
        self.closed=true;
    }
    function minify(){
        e.hide();
        cl.hide();
        mi.hide();
        self.fire("minify");
    }
    const self=EventHandler.attachTo({
        element:e[0],show,
        closeButton:cl,
        close,minify,
    });
    return self;
}
