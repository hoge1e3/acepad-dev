import vfs_py from "./vfs_py.js";
import {wrap} from "@hoge1e3/splashscreen";

// acepad-python
/*global $B*/
function load(){
    return new Promise((s)=>{
        window.onBrythonLoaded=([addPath, execFile, setOut])=>
            s({addPath, execFile, setOut});
        setup();
    });
}
async function setup(){
    const src=vfs_py;
    const s2=document.createElement("script");
    s2.innerHTML=src;
    s2.setAttribute("type","text/python3");
    document.body.appendChild(s2);
    const load=(src)=>new Promise((suc)=>{
        const s=document.createElement("script");
        s.setAttribute("src",src);
        document.body.appendChild(s);
        s.addEventListener("load",suc);
    });
    const head="https://brython.info";
    await load(`${head}/brython.js`);
    await load(`${head}/brython_stdlib.js`);
    await $B.brython();
}
const py=await wrap("Setup python",load)();
export const addPath=py.addPath;
export const execFile=py.execFile;
export const setOut=py.setOut;
