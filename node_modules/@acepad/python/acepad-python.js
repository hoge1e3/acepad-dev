import vfs_py from "./vfs_py.js";
import {wrap} from "@acepad/splashscreen";
import MutablePromise from "mutable-promise";
import {loadScriptTag} from "@hoge1e3/loadScript";

// acepad-python
/*global $B*/
function load(){
    const p=new MutablePromise();
    window.onBrythonLoaded=
        ([addPath, execFile, setOut])=>
        p.resolve({addPath, execFile, setOut});
    setup().then(()=>0, p.reject);
    return p;
}
async function setup(){
    if (!process.release) process.release={};
    const src=vfs_py;
    const s2=document.createElement("script");
    s2.innerHTML=src;
    s2.setAttribute("type","text/python3");
    document.body.appendChild(s2);
    const head="https://brython.info";
    await loadScriptTag(`${head}/brython.js`);
    await loadScriptTag(`${head}/brython_stdlib.js`);
    await $B.brython();
}
const py=await wrap("Setup python",load)();
export const addPath=py.addPath;
export const execFile=py.execFile;
export const setOut=py.setOut;
