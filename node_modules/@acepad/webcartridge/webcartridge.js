#!run
import {setPackageJson, getPackageJson} from "./pkg.js";
import {main as setMenu} from "./setmenu.js";
export async function main(file){
  const sh=this;
  const ver=new Date().toLocaleString("ja-JP", {year: "numeric",month: "2-digit",
   day: "2-digit", hour:"2-digit", 
   minute:"2-digit", second:"2-digit"}).
   replace(/[\-\/:]/g, '').replace(" ","-");
   
  const newurl=await sh.serve(file, 
  new URL(`gen/boot/pnode-${ver}.js`,location.href));
  const pk=await getPackageJson();
  console.log("pk",pk);
  pk.menus=pk.menus||{};
  pk.menus[ver]={
    main:newurl,
  };
  await setPackageJson.call(sh,pk);
  await setMenu.call(sh,pk);
}
