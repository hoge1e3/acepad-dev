#!run
import {setPackageJson, getPackageJson} from "./pkg.js";
import {main as setMenu} from "./setmenu.js";
export async function main(file){
  const sh=this;
  const ver=new Date().toLocaleString("ja-JP", {year: "numeric",month: "2-digit",
   day: "2-digit", hour:"2-digit", 
   minute:"2-digit", second:"2-digit"}).
   replace(/[\-\/:]/g, '').replace(" ","-");
   
  const newurl=await sh.serve(file, 
  new URL(`gen/boot/pnode-${ver}.js`,location.href));
  const pkg=await getPackageJson();
  console.log("pkg",pkg);
  pkg.menus=pkg.menus||{};
  pkg.menus[ver]={
    icontext:"ðŸ“€",
    main:newurl,
    order:10,
  };
  //await setPackageJson.call(sh,pk);
  await setMenu.call(sh,{pkg,url:newurl});
}
