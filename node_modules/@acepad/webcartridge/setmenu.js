#!run
import {setPackageJson, getPackageJson} from "./pkg.js";
export async function main() {
  if (!process.env.WEBCARTRIDGE_MAIN) return;
  const pk_pnode=this.resolve("/package.json").obj();
  const pk_wcart=await getPackageJson();
  pk_wcart.menus=pk_wcart.menus||{};
  //const deleted={};
  for (let k in pk_wcart.menus){
    if (pk_wcart.menus[k].autostart) {
      //deleted[k]=pk_wcart.menus[k];
      delete pk_wcart.menus[k];
    }
  }
  for (let k in pk_pnode.menus||{}){
    pk_wcart.menus[k]={
      icontext: pk_pnode.menus[k].icontext,
      main:process.env.WEBCARTRIDGE_MAIN,
      autostart: k
    };
  } 
  await setPackageJson.call(this,pk_wcart);
  console.log("new pkg",pk_wcart);
}