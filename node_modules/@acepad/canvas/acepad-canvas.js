// acepad-canvas
//!run
/* global $*/
import {showWidget} from "@acepad/widget";
export function raf(){
    return new Promise(requestAnimationFrame);
}
export function canvas(){
    let wid=showWidget("<canvas>");
    let cv=wid.element;
    let ctx=cv.getContext("2d");
    const rect = cv.getBoundingClientRect();
    let w = Math.floor(rect.width);
    let h = Math.floor(rect.height);
    cv.setAttribute("width", w);
    cv.setAttribute("height", h);
    wid.on("close",()=>ctx.disposed=true);
    
    return {w,h,ctx,
        async raf(){
            if(ctx.disposed)return false;
            await raf();
            return true;
        }
    };
}
export function rnd(n){
    return n==null?Math.random():Math.floor(rnd()*n);    
}
let tasks;
export function task(g){
    if(!tasks){
        tasks=[];
        requestAnimationFrame(loopTask);
    }
}
function loopTask(){
        
    requestAnimationFrame(loopTask);
    
}