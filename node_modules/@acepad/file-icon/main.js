import {renderDirectory,splash,sleep} from "./file-icon.js";
import {importModule,file,getFS} from "petit-node";

renderDirectory(process.cwd());
addEventListener("openfile",async (e)=>{
  const {path:fullPath}=e.detail;
  splash(true);
  await sleep(10);
  try{
    const f=file(fullPath);
    if(f.endsWith(".js")){
      const m=await importModule(fullPath);
      if("main" in m){
        if(typeof m.main==="function"){
          m.main();
        }
      }
    }else if(f.endsWith(".zip")){
      await getFS().zip.unzip(f,f.up());
      renderDirectory(f.up().path());
    }else{
      alert(fullPath);
    }
  }catch(e){
    alert(e.stack);
  } finally{
    splash(false); 
  }
});
