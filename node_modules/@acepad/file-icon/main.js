import {renderDirectory} from "./file-icon.js";
import {importModule,file} from "petit-node";
import {sleep} from "@hoge1e3/timeout";

renderDirectory(process.cwd());
addEventListener("openfile",async (e)=>{
  const {path:fullPath}=e.detail;
  await sleep(10);
  try{
    const f=file(fullPath);
    if(f.endsWith(".js")){
      const m=await importModule(fullPath);
      if("main" in m){
        if(typeof m.main==="function"){
          m.main();
        }
      }
    }else{
      alert(fullPath);
    }
  }catch(e){
    alert(e.stack);
  }  
});