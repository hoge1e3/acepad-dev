#!run 
import {getFS, require, file} from "petit-node";

export async function main(){
  if(!file("/tsc-idb/").exists()){    
    await getFS().mountAsync("/tsc-idb","idb",{
      dbName: "tsc-idb",
      storeName: "kvStore"
    });
    console.log("tsc-idb mounted");
  }
  console.log("/tsc-idb",...file("/tsc-idb/").ls());
    
  //this.fstab();
  
  let ts;
  try{
    const ndm=file("/node_modules/");
    if(!ndm.exists()){
      await ndm.link(file("/tsc-idb/node_modules/"));
    }
    console.log("/tsc-idb",...file("/tsc-idb/node_modules/").ls());
    console.log("/",...file("/node_modules/").ls());
    ts=require("typescript", ndm);
    console.log("tsc loaded");
    return ts;
  }catch(e){
    // download tsc.zip and extract
    console.error(e);
  }
}