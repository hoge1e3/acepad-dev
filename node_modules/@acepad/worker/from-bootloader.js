#!run
import {getDeviceManager} from "pnode:main";
import * as rpc from "@hoge1e3/rpc";
export async function main(){
  const b=new Worker(
    this.$PNODE_BOOTLOADER_URL,{
      type:"module"
    });
  const w=rpc.proxy.client(b,"boot");
  const fstab=getDeviceManager().
    readFstab("/fstab.json",[]);
  const id=Math.random()+""
  await w.boot({
    fstab,
    id,
    main:"/idb/run/sbin/tmp/wtest.js"
  })
  const m=rpc.proxy.client(b,"default");
  
  return m.test(21);
}