import {DocumentSet,Document} from "@hoge1e3/ngram";
import {file} from "@acepad/here";
let s;
export async function init(dir) {
    if (s) return;
    const exts=[".js",".ts",".json"];
    dir=file(dir);
    s=new DocumentSet();
    
    let i=0;
    for(let f of dir.recursive()){
        i++;
        if(i%10==0)await timeout(1);
        if(!exts.includes(f.ext()))continue;
        let d=new Document(f.relPath(dir),f.text());
        s.addDocument(d);
    }
    console.log("para-w1",i);
    for(i=0;i<300000;i++){
        let p=s.expand();
        //sug.text(p);
        if(p<4)break;
        if(i%10==0)await timeout(1);
        if(i%5000==0) {
        //console.log("para2",i,p);
            s.calcCount();
        }
    }
    s.calcCount();
}
export async function predict(text,offset){// text:string, offset:number
    if (!s) throw new Error("Call init first.");
    const d=new Document("p",text);
    const c=await s.predict(d,offset);
    return c;
}