
import {sessionInfo} from "@acepad/sessions";
const run=Symbol("autoSync");
export function init(editor){
    if(editor[run]!=null)return ;
    editor[run]=setInterval(()=>{
        autoSync(editor.session);
    },100);
}
function autoSync(s){
    const si=sessionInfo(s);
    let f=si.file;
    if(!f)return;
    if(f.isDir())return ;
    const ds=(si.val!=s.getValue()?"differ":"same");
    if (ds!=="same")shd("auto",f.lastUpdate(),si.ts,ds);
    if(f.lastUpdate()>si.ts){
        s.setValue(f.text());
        si.val=s.getValue();
        si.ts=f.lastUpdate();
    }else if(si.val!=s.getValue()){
        f.text(s.getValue());
        si.val=s.getValue();
        si.ts=f.lastUpdate();
    }
}

export function shd(...a){
    if(window.shown){
        console.log("shd",...a);
    }
}
