
const run=Symbol("autoSync");
export function init(acepad){
    const {getMainEditor,
    sessionInfo,createSession,
    events,locate,print,currentLine}=acepad;
    if(acepad[run]!=null)return ;
    const editor=getMainEditor();
    acepad[run]=setInterval(()=>{
        autoSync(acepad, editor.session);
    },100);
}
function autoSync(acepad, s){
    const si=acepad.sessionInfo(s);
    let f=si.file;
    if(!f)return;
    if(f.isDir())return ;
    const ds=(si.val!=s.getValue()?"differ":"same");
    if (ds!=="same")shd("auto",f.lastUpdate(),si.ts,ds);
    if(f.lastUpdate()>si.ts){
        s.setValue(f.text());
        si.val=s.getValue();
        si.ts=f.lastUpdate();
    }else if(si.val!=s.getValue()){
        f.text(s.getValue());
        si.val=s.getValue();
        si.ts=f.lastUpdate();
    }
}

export function shd(...a){
    if(window.shown){
        console.log("shd",...a);
    }
}
