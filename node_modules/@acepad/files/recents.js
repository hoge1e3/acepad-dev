#!run 
import {Lru} from "@hoge1e3/lru";
export function main(){
    for (let f of list(this)) {
        this.echo("edit",f.path());
    }
}
function submenusFile(sh){
  return recfile(sh).sibling("submenus.json");
}
function recfile(sh) {
    let acepadConf=sh.directorify(sh.get("ACEPAD_CONF")||"/.acepad/");
    return acepadConf.rel("recents.json");
}
export function read(sh){
    let raw={};
    try{
        raw=recfile(sh).obj();
    }catch(e) {}
    const l=new Lru(raw, {key:"path"});
    return l;
}
export function add(sh, file) {
    const l=read(sh);
    l.add({path: file.path()}).limit(16);
    recfile(sh).obj(l.raw);
    try{
      const l=read(sh);
      const r= [...l].map(o=>o.path);
      submenusFile(sh).obj(r);
    }catch(e){
      console.error(e);
    }
}
export function list(sh){
    const l=read(sh);
    return [...l].map(o=>sh.resolve(o.path));
}
