import { BranchName, Hash, FilePath, State, APIConfig } from './types.js';
import { ObjectStore, ObjectEntry, ObjectValue } from './objects.js';
import { WebApi } from './webapi.js';
import { Repo } from './git.js';
export declare const GIT_DIR_NAME = ".gsync";
export declare class SyncFactory {
    gitDir: FilePath;
    constructor(gitDir: FilePath);
    readConfig(): Promise<APIConfig>;
    writeConfig(conf: APIConfig): Promise<void>;
    private confFile;
    init(serverUrl: string): Promise<Sync>;
    load(): Promise<Sync>;
}
export declare class Sync {
    factory: SyncFactory;
    gitDir: FilePath;
    objectStore: ObjectStore;
    webapi: WebApi<APIConfig>;
    repo: Repo;
    constructor(factory: SyncFactory, gitDir: FilePath, objectStore: ObjectStore, webapi: WebApi<APIConfig>);
    getObjectStore(): Promise<ObjectStore>;
    getWebApi(): Promise<WebApi<APIConfig>>;
    readState(): Promise<State>;
    writeState(state: State): Promise<void>;
    uploadObjects(): Promise<void>;
    readConfig(): Promise<APIConfig>;
    hasRemoteHead(branch: BranchName): Promise<boolean>;
    getRemoteHead(branch: BranchName): Promise<Hash>;
    setRemoteHead(branch: BranchName, current: Hash, next: Hash): Promise<void>;
    addRemoteHead(branch: BranchName, next: Hash): Promise<void>;
}
export declare class DownloadableObjectStore implements ObjectStore {
    offline: ObjectStore;
    api: WebApi<APIConfig>;
    constructor(offline: ObjectStore, api: WebApi<APIConfig>);
    has(hash: Hash): Promise<boolean>;
    get(hash: Hash): Promise<ObjectValue>;
    put(hash: Hash, compressed: Uint8Array, downloaded: boolean): Promise<void>;
    iterate(since: Date): AsyncGenerator<ObjectEntry>;
    getState(): Promise<State>;
    setState(state: State): Promise<void>;
}
