import { FilePath, Hash, State } from "./types.js";
import MutablePromise from "mutable-promise";
export type ObjectValue = {
    content: Uint8Array;
    mtime: Date;
};
export type ObjectEntry = {
    hash: Hash;
} & ObjectValue;
export interface ObjectStore {
    has(hash: Hash): Promise<boolean>;
    get(hash: Hash): Promise<ObjectValue>;
    put(hash: Hash, compressed: Uint8Array, downloaded: boolean): Promise<void>;
    iterate(since: Date): AsyncGenerator<ObjectEntry>;
    getState(): Promise<State>;
    setState(state: State): Promise<void>;
}
export declare function factory(gitDir: FilePath): Promise<ObjectStore>;
export declare function maxMtime(o: ObjectStore): Promise<Date>;
export declare function reqP<T>(request: IDBRequest<T>): Promise<T>;
export declare function singleStoreTransaction(db: IDBDatabase, table: string, mode?: IDBTransactionMode): IDBObjectStore;
export declare class IndexedDBBasedObjectStore implements ObjectStore {
    dbName: string;
    stateFile: FilePath;
    private db;
    dbInit: MutablePromise<IDBDatabase>;
    constructor(dbName: string, stateFile: FilePath);
    getState(): Promise<State>;
    setState(state: State): Promise<void>;
    has(hash: Hash): Promise<boolean>;
    get(hash: Hash): Promise<ObjectValue>;
    put(hash: Hash, compressed: Uint8Array, downloaded: boolean): Promise<void>;
    iterate(since: Date): AsyncGenerator<ObjectEntry>;
}
export declare class FileBasedObjectStore implements ObjectStore {
    path: FilePath;
    stateFile: FilePath;
    constructor(path: FilePath, stateFile: FilePath);
    getState(): Promise<State>;
    setState(state: State): Promise<void>;
    private pathOf;
    has(hash: Hash): Promise<boolean>;
    get(hash: Hash): Promise<ObjectValue>;
    put(hash: Hash, compressed: Uint8Array, downloaded: boolean): Promise<void>;
    iterate(since: Date): AsyncGenerator<ObjectEntry>;
}
