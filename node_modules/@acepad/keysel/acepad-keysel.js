//!run
// acepad-keysel
import {showIframe} from "@acepad/widget";
export async function main(skip){
    if(skip){
        if(localStorage.mobile!=null)return;
        if(localStorage.nomobile!=null)return;
    }
    const sh=this;
    const dirn=(sh.resolve(import.meta.url).up());
    let w=showIframe(dirn.rel("keysel.html"));
    w.on("load",()=>{
        let c=w.iframe.contentWindow;
        let d=c.document;
        d.body.addEventListener("keydown",sel(false));
        let ph=d.querySelector(".physical");
        let sc=d.querySelector(".screen");
        ph.addEventListener("click",()=>
            ph.innerHTML="Press any key");
        sc.addEventListener("click",sel(true));
        c.focus();
    });
    let acepad=sh.$acepad;//.selectKeyDevice("s");
    function sel(m){
        return function (){
            if(m){
                localStorage.mobile=true;
                delete localStorage.nomobile;
                if(acepad)acepad.selectKeyDevice("s");
            }else {
                localStorage.nomobile=true;
                delete localStorage.mobile;
                if(acepad)acepad.selectKeyDevice("p");
            }
            w.close();
        };
    }
        
}