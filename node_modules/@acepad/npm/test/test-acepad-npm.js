import * as npm from "@acepad/npm";
import * as assert from "assert";
import {KeySet} from "@hoge1e3/keyset";

export async function main(){
    /*
    const pa=this.resolve(
        import.meta.url
    ).up().rel("../package.json");
    */
    const depp=new KeySet((f)=>f.path());
    depp.add(this.resolve("package.json"));
    depp.add(this.resolve("package.json"));
    for(let p of depp){
        this.echo(p);
    }

    const pa=this.resolve(this.$home+"/package.json");
    this.echo(pa.path());
    this.echo("----");
    for(let p of await npm.getDeps(pa)){
        this.echo(p);
        await this.sleep(0.01);
    }
    this.echo("----");
    const d=await npm.getDeps(pa,true);
    //d.chkuniq();
    //this.echo(d.__id);
    for(let p of d){
        const k=d.key(p);
        if(typeof k!=="string"){
            throw new Error("nostr");
        }
        this.echo(p);
        await this.sleep(0.01);
    }
}    
