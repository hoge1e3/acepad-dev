#!run
import * as pNode from "pnode:main";
export async function main(){
  const cur=this.resolve(".");
  const webpack=pNode.require("webpack",cur);
  let config = pNode.require('./webpack.config.cjs',cur);
  globalThis.global=globalThis;
  process.chdir(cur.path());
  console.log("cwd", process.cwd());
  if (typeof config==="function") config=config(process.env,[]);
  console.log("conf",config);
  const compiler = webpack(config);
  compiler.run((err, stats) => {
    if (err) {
      console.error('Webpack error:', err);
      return;
      //process.exit(1);
    }
    this.echo(stats.toString({ colors: false }));
    compiler.close(() => {});
  });
}
