#!run

export async function main(file, path){
  file=this.resolve(file);
  const reg= await navigator.serviceWorker.ready;
  let base=reg.scope;
  path=path||file.path();
  path=path+"";
  if (!base.endsWith("/")) base+="/";
  if (path.startsWith("/")) path=path.substring(1);
  const url=
    path.match(/^https?:/)?
    path:
    base+"gen/"+path;
  const blob = file.getBlob();
  reg.active.postMessage({
    type: "serve_blob",
    url,
    blob
  });
  return url;
}

