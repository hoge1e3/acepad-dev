// textmatcher
export function matcher(str,a){
    let param=(typeof str==="string"?{str}:str);
    str=param.str;
    const m={
        match(reg,f){
            let r=reg.exec(str);
            if(r){
                let n=r.index+r[0].length;
                let rest=str.substring(n);
                let a=Array.from(r);                
                let nm=m.with({str:rest,matched:true},a);
                return nm.with(f(nm,...a));
            }else return m;
        },
        elif(reg,f){
            if(m.matched)return m;
            return m.match(reg,f);
        },
        else(f){
            let nm=m.with({matched:false});
            if(m.matched){
                return nm;
            }
            return nm.with(f(nm));
        },
        with(p,a){
            let pp={};
            Object.assign(pp,m);
            Object.assign(pp,p);
            return matcher(pp,a);    
        },
    };
    Object.assign(m,param);
    if(a){
        for(let i=0;i<a.length;i++)m[i]=a[i];
    }
    return m;
}