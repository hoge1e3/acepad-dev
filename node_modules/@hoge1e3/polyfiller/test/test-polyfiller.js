import {myp} from "./p.js";
import * as polyfiller from "@hoge1e3/polyfiller";
import * as assert from "assert";
import {convertStack,FS} from "acepad-os";
import {hasTrace} from "acepad-debug";
console.log("p2","loaded test");
export async function main(){
    let d=dir(this).up();
    let a=this.$acepad;
    let rm=polyfiller.events.on("missing",({key,id,extend,trace})=>{
        assert.ok(d.isDir(),"isDir");
        const {file,line}=extend(id,d,key,`()=>{
    //${convertStack(trace[0])}
    //${usage(trace)}
},`);
        this.edit(file,{row:line});
    });
    try{
        myp().foo(3);
    }finally{
        rm.remove();
    }
}    
function usage(trace){
    let s=convertStack(trace[0]);   
    let t=hasTrace(s);
    if(!t)return s;
    return t.file.lines()[t.row-1];
}
function dir(sh){
    const u=import.meta.url+"";
    return(sh.resolve(u));
}

