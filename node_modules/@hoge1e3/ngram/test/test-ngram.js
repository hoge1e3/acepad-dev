import * as ngram from "@hoge1e3/ngram";
import * as assert from "assert";
/*
cd /jsmod/node_modules/@hoge1e3/ngram/
npm-test
*/

export async function main(){
    let d=new ngram.Document("A","abcc deff adc eed abc");
    let s=new ngram.DocumentSet();
    s.addDocument(d);
    console.log(s);
    this.echo(d.content);
    traverse.call(this,s.root);
    for(let i=0;i<3;i++)
    this.echo(s.expand());
    s.calcCount();
    traverse.call(this,s.root);
    allWords.call(this,s.root);
}    
function allWords(idx,ctx=""){
    if(idx.keyType=="doc"){
        for(let [doc, offsets] of idx.map){
            this.echo(ctx,doc,offsets.join(" "));
        }
    }else{
        for(let [chr, sidx] of idx.map){
            allWords.call(this,sidx,ctx+chr);
        }
    }
}
function traverse(idx){
    let p=(...a)=>{
        a.push({n:1});this.echo(...a);
    };
    p("{");
    for(let [k,v] of idx.map){
        if(v.keyType){
            p(k,": ");traverse.call(this,v);
        }else{
            p(k,v);
        }
        p(", ");
    
    }
    p("}");
    
}