import {renderer,R} from "@hoge1e3/dom-template";
import * as assert from "assert";
import * as dom from "@hoge1e3/dom";
import * as updater from "@hoge1e3/dom-updater";
import loadcss from "@acepad/css";
import {show} from "@acepad/widget";
const t=dom.generator();
export async function main(){
    const {element}=show(t.div(),{overlay:true});
    const items=R([
        R({text:"AAA"}),
        R({text:"BBB"}),
    ]);
    loadcss(this.resolve(
        import.meta.url
        ).sibling("dom-template.css"));
    const base=t.div({id:items.id,class:"domup"});
    element.appendChild(base);
    const r=renderer(base, items);
    r.start((items)=>{
        function addItem() {
            const item=R({});
            item.text=`#${item.id}`;
            items.push(item);
            items.update();
            r.update();
        }
        function ud(item,by){
            const i=items.indexOf(item);
            items.splice(i,1);
            items.splice(i+by,0,item);
            items.update();
            r.update();
        }
        const it=r.template((item,items)=>
            t.div(
                t.input({
                    //id:`${item.id}-text`,
                    value:item.text,
                    oninput() {
                        item.update({text:this.value});
                        r.update();
                    }
                }),
                item.text,
                t.button({
                    //id:"UP"+item.id,
                    onclick:()=>ud(item,-1)},"up"),
                t.button({
                    //id:"DW"+item.id,
                    onclick:()=>ud(item,1)},"dw"),
            ));
        return t.div({class:"domup"},
            t.button({
                //id:"addb",
                onclick:addItem
            },"Add"),
            ...items.map(it),
        );
    });
    
}
